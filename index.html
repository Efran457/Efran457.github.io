<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Fun - Snake</title>
<style>
body {
  background-color: #32C5FF;
  font-family: Arial, sans-serif;
  overflow: hidden;
  margin: 0;
}
#apple {
  width: 50px;
  height: 50px;
  background-color: green;
  position: absolute;
  border-radius: 50%;
}
#wurfel {
  width: 50px;
  height: 50px;
  background-color: lightblue;
  position: absolute;
  top: 200px;
  left: 200px;
}
p {
  background-color: #2599C7;
  font-size: 18px;
  padding: 10px;
  border-radius: 8px;
  color: white;
  position: fixed;
  top: 10px;
  left: 10px;
  margin: 0;
}
#Record {
  top: 50px;
}
button {
  background-color: #2599C7;
  color: white;
  font-size: 18px;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  position: fixed;
  top: 10px;
  right: 10px;
}
button:hover {
  background-color: #1E7CA0;
}
</style>
</head>
<body>
<div id="wurfel"></div>
<div id="apple"></div>
<p id="points">Punkte: 0</p>
<p id="Record">Lade Rekord...</p>
<button onclick="OpenSite('https://efran457.github.io/Fun.github.io')">â†’</button>

<script type="module">
/* ---------- Game + Firebase Setup ---------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyC1ZYypZ4-fms45zqA_UutYFmbXQ4q3psI",
  authDomain: "imran-id123.firebaseapp.com",
  databaseURL: "https://imran-id123-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "imran-id123",
  storageBucket: "imran-id123.firebasestorage.app",
  messagingSenderId: "397729453639",
  appId: "1:397729453639:web:c1e77be6ca3288418d4362",
  measurementId: "G-EREE36DJSL"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const recordRef = ref(db, "record");

// Elements
const wurfel = document.getElementById("wurfel");
const apple = document.getElementById("apple");
const pointsDisplay = document.getElementById("points");
const recordDisplay = document.getElementById("Record");

// Game Variables
let wurfelx = 200;
let wurfely = 200;
let speed = 5;
let dirX = 0;
let dirY = 0;
let score = 0;
let record = 0;
let recordLoaded = false;

// ðŸŸ¢ Load Record from Firebase
onValue(recordRef, (snapshot) => {
  const val = snapshot.val();
  if (val !== null) {
    record = val;
    recordDisplay.textContent = "Rekord: " + val;
  } else {
    recordDisplay.textContent = "Noch kein Rekord!";
  }
  recordLoaded = true;
});

// ðŸŸ¢ Respawn apple and update points
function applePosReset() {
  const x = Math.random() * (window.innerWidth - 50);
  const y = Math.random() * (window.innerHeight - 50);
  apple.style.left = x + "px";
  apple.style.top = y + "px";
  score++;
  pointsDisplay.textContent = "Punkte: " + score;

  // âœ… Only update Firebase if new score beats record
  if (recordLoaded && score > record) {
    record = score;
    recordDisplay.textContent = "Rekord: " + record;
    set(recordRef, record);
  }
}

// ðŸŸ¢ Movement controls
document.addEventListener("keydown", (e) => {
  if (e.key === "w") { dirX = 0; dirY = -1; }
  else if (e.key === "s") { dirX = 0; dirY = 1; }
  else if (e.key === "a") { dirX = -1; dirY = 0; }
  else if (e.key === "d") { dirX = 1; dirY = 0; }
});

// ðŸŸ¢ Collision detection
function checkCollision(rect1, rect2) {
  return !(
    rect1.right < rect2.left ||
    rect1.left > rect2.right ||
    rect1.bottom < rect2.top ||
    rect1.top > rect2.bottom
  );
}

// ðŸŸ¢ External site button
function OpenSite(site) {
  window.open(site, "_self");
}

// ðŸŸ¢ Game Loop
function loop() {
  wurfelx += dirX * speed;
  wurfely += dirY * speed;

  // Keep within screen
  wurfelx = Math.max(0, Math.min(window.innerWidth - 50, wurfelx));
  wurfely = Math.max(0, Math.min(window.innerHeight - 50, wurfely));

  wurfel.style.left = wurfelx + "px";
  wurfel.style.top = wurfely + "px";

  const wurfelRect = wurfel.getBoundingClientRect();
  const appleRect = apple.getBoundingClientRect();
  if (checkCollision(wurfelRect, appleRect)) {
    applePosReset();
  }

  requestAnimationFrame(loop);
}

// ðŸŸ¢ Start game
applePosReset();
loop();
</script>
</body>
</html>
